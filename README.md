# foc-based-servo
**Рассмотрение различных способов управления [BLDC](https://www.robotdigg.com/product/1000/5008-KV335-or-5010-KV340-brushless-motor) с помощью библиотеки [SimpleFOC](https://docs.simplefoc.com/) и драйвера [SimpleFOC PowerShield](https://github.com/simplefoc/Arduino-SimpleFOC-PowerShield) на Arduino UNO**
## Содержание

- [Содержание](#содержание)
- [Управление по скорости с разомкнутым контуром](#управление-по-скорости-с-разомкнутым-контуром)
- [Управление по скорости с обратной связью](#управление-по-скорости-с-обратной-связью)
- [Управление по положению с обратной связью](#управление-по-положению-с-обратной-связью)

## Управление по скорости с разомкнутым контуром
В библиотекет SimpleFOC реализовано управление BLDC двигателем с помощью Векторного управления. Для реализации этих алгоритмов необходимо использавать датчик положения, мной был использован датчик [AS5047P](https://www.mouser.com/datasheet/2/588/AS5047P-TS_EK_AB_Operation-Manual_Rev.1.0-775823.pdf) с обменой данных через SPI интерфейс.
### Соединение с Arduino UNO
| AS5047P Pin | Arduino Uno Pin | Comment |
|:-----------:|:-----------:|:--------|
| GND | GND | - |
| VDD | 5V | - |
| VDD3V| NC | - |
| MOSI | MOSI (Pin: 11) | - |
| MISO | MISO (Pin: 12) | - |
| CLK | SCK (Pin: 13) | - |
| CSn | 9 | Can be any unused digital pin on the arduino as long as it's configured here `AS5047P as5047p(<ChipSelectPort>);` |

Структурная схема системы и теория управления приведены [здесь](https://docs.simplefoc.com/velocity_openloop). Фазное сопротивление обмотки двигателя неизвестно, поэтому ограничение устанавливалось по потребляемому напряжению, а не току, что влияет на точность управления.

## Управление по скорости с обратной связью

Для управления скоростью с обратной связью я использовал ПИД-регулятор, настройка которого была произведена методом Циглера-Никольса. СТруктурная схема системы управления приведена [здесь](https://docs.simplefoc.com/velocity_loop). Контур управления моментом имеет структуру, которая описана [здесь](https://docs.simplefoc.com/torque_control). Контур управления моментом работает в режиме Voltage mode.

## Управление по положению с обратной связью

Структурная схема системы управления двигателем приведена [здесь](https://docs.simplefoc.com/angle_loop). Для оптимадьного управления помимо ПИД-регулятора в контуре тока используется ПИД-регулятор в контуре положения, настройка которого также производилась с помощью эмпирического метода Циглера-Никольса.
